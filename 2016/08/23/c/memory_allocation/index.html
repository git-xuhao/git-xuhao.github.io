<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="/js/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>c语言（五）内存分配与释放 | Xiho’s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="C/C++编程语言" />
  
  
  
  
  <meta name="description" content="首先我们来科普一下： 什么是堆？说到堆，又忍不住说到了栈！什么是 栈？1、什么是堆：堆是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程 初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。2、什么是栈：栈是线程独有的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈">
<meta name="keywords" content="C&#x2F;C++,编程语言">
<meta property="og:type" content="article">
<meta property="og:title" content="C语言（五）内存分配与释放">
<meta property="og:url" content="http://xuhaoblog.com/2016/08/23/c/memory_allocation/index.html">
<meta property="og:site_name" content="Xiho’s Blog">
<meta property="og:description" content="首先我们来科普一下： 什么是堆？说到堆，又忍不住说到了栈！什么是 栈？1、什么是堆：堆是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程 初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。2、什么是栈：栈是线程独有的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-11-04T11:02:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C语言（五）内存分配与释放">
<meta name="twitter:description" content="首先我们来科普一下： 什么是堆？说到堆，又忍不住说到了栈！什么是 栈？1、什么是堆：堆是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程 初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。2、什么是栈：栈是线程独有的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈">
  
    <link rel="alternate" href="/atom.xml" title="Xiho’s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">

</head>

<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/archives"] = "Archives"; 

  themeMenus["/categories"] = "Categories"; 

  themeMenus["/tags"] = "Tags"; 

  themeMenus["/about"] = "About"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Xiho’s Blog" rel="home"> Xiho’s Blog </a>
            
          </h1>

          
            <div class="site-description">Android Developer</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">Categories</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "css/images/pose.jpg,https://source.unsplash.com/collection/954550/1920x1080".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-c/memory_allocation" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      C语言（五）内存分配与释放
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2016/08/23/c/memory_allocation/" class="article-date">
	  <time datetime="2016-08-23T05:10:26.000Z" itemprop="datePublished">August 23, 2016</time>
	</a>

      
	<span id="busuanzi_container_page_pv">
	  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先我们来科普一下：</p>
<h2 id="什么是堆？说到堆，又忍不住说到了栈！什么是-栈？"><a href="#什么是堆？说到堆，又忍不住说到了栈！什么是-栈？" class="headerlink" title="什么是堆？说到堆，又忍不住说到了栈！什么是 栈？"></a><strong>什么是堆？说到堆，又忍不住说到了栈！什么是 栈？</strong></h2><p><strong>1、什么是堆：</strong>堆是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程 初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。<br><strong>2、什么是栈：</strong>栈是线程独有的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈互相独立。每个函数都有自己的栈，栈被用来在函数之间传递参数。操作系统在切换线程的时候会自动的切换栈，就是切换SS/ESP寄存器。栈空间不需要在高级语言里面显式的分配和释放。<br><a id="more"></a> </p>
<h2 id="C语言程序编译的内存分配，堆与栈的区别："><a href="#C语言程序编译的内存分配，堆与栈的区别：" class="headerlink" title="C语言程序编译的内存分配，堆与栈的区别："></a><strong>C语言程序编译的内存分配，堆与栈的区别：</strong></h2><ul>
<li>栈是由编译器自动分配释放，存放函数的参数值、局部变量的值等。操作方式类似于数据结构中的栈。<br>堆一般由程序员分配释放，若不释放，程序结束时可能由OS回收。注意这里说是可能，并非一定。再强调一次，记得要释放！</li>
<li>栈区(stack) :<br>   //windows下，栈内存分配2M（确定的常数），超出了限制，提示stack overflow错误<br> //编译器自动分配释放，主要存放函数的参数值，局部变量值等；</li>
<li><p>堆区(heap)：程序员手动分配释放，操作系统80%内存</p>
</li>
<li><p>全局区或静态区：存放全局变量和静态变量；程序结束时由系统释放，分为全局初始化区和全局未初始化区；</p>
</li>
<li><p>字符常量区：常量字符串放与此，程序结束时由系统释放；</p>
</li>
<li><p>程序代码区：存放函数体的二进制代码。</p>
</li>
</ul>
<p>栗子：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a=<span class="number">0</span>;        <span class="comment">//全局初始化区</span></span><br><span class="line"><span class="keyword">char</span> *p1;       <span class="comment">//全局未初始化区</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> b;          <span class="comment">//栈</span></span><br><span class="line">   <span class="keyword">char</span> s[]=<span class="string">"bb"</span>;  <span class="comment">//栈</span></span><br><span class="line">   <span class="keyword">char</span> *p2;       <span class="comment">//栈</span></span><br><span class="line">   <span class="keyword">char</span> *p3=<span class="string">"123"</span>; <span class="comment">//其中，“123\0”常量区，p3在栈区</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">int</span> c=<span class="number">0</span>; <span class="comment">//全局区</span></span><br><span class="line">   p1=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">10</span>);   <span class="comment">//10个字节区域在堆区</span></span><br><span class="line">   <span class="built_in">strcpy</span>(p1,<span class="string">"123"</span>);    <span class="comment">//"123\0"在常量区，编译器 可能 会优化为和p3的指向同一块区域</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>栈内存</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stackFun</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">1024</span>];</span><br><span class="line">	<span class="comment">//栈内存自动释放</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>堆内存</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapFun</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//40M内存</span></span><br><span class="line">	<span class="comment">//字节</span></span><br><span class="line">	<span class="comment">//void *任意类型的指针</span></span><br><span class="line">	<span class="keyword">int</span>* p = <span class="built_in">malloc</span>(<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">10</span> * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放</span></span><br><span class="line">	<span class="built_in">free</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">void</span> <span class="selector-tag">main</span>()&#123;	</span><br><span class="line">	<span class="comment">//在堆内存上，分配40M的内存</span></span><br><span class="line">	<span class="selector-tag">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="selector-tag">Sleep</span>(<span class="number">1000</span>);	</span><br><span class="line">		<span class="selector-tag">stackFun</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="selector-tag">getchar</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建一个数组，动态指定数组的大小（在程序运行过长中，可以随意的开辟指定大小的内存，以供使用，相当于Java中的集合）<br><strong>静态内存分配</strong>，分配内存大小的是固定，问题：1.很容易超出栈内存的最大值 2.为了防止内存不够用会开辟更多的内存，容易浪费内存</p>
<p><strong>动态内存分配</strong>，在程序运行过程中，动态指定需要使用的内存大小，手动释放，释放之后这些内存还可以被重新使用（活水）</p>
<p><strong>函数：calloc()  分配内存空间并初始化</strong><br>calloc() 函数用来动态地分配内存空间并初始化为 0，其原型为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">calloc</span> <span class="params">(<span class="keyword">size_t</span> num, <span class="keyword">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<p>calloc() 在内存中动态地分配 num 个长度为 size 的连续空间，并将每一个字节都初始化为 0。所以它的结果是分配了 num*size 个字节长度的内存空间，并且每个字节的值都是0。</p>
<p>【返回值】分配成功返回指向该内存的地址，失败则返回 NULL。</p>
<p><strong>函数：malloc() 动态地分配内存空间</strong></p>
<p>malloc() 函数用来动态地分配内存空间（如果你不了解动态内存分配，请查看：C语言动态内存分配及变量存储类别），其原型为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">malloc</span> <span class="params">(<span class="keyword">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<p>应用在程序中代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//静态内存分配创建数组，数组的大小是固定的</span></span><br><span class="line">	<span class="comment">//int i = 10;</span></span><br><span class="line">	<span class="comment">//int a[i];</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> len;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"输入数组的长度："</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;len);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//开辟内存，大小len*4字节</span></span><br><span class="line">	<span class="keyword">int</span>* p = <span class="built_in">malloc</span>(len * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">	<span class="comment">//p是数组的首地址，p就是数组的名称</span></span><br><span class="line">	<span class="comment">//给数组元素赋值（使用这一块刚刚开辟出来的内存区域）</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (; i &lt; len - <span class="number">1</span>; i++)&#123;</span><br><span class="line">		p[i] = rand() % <span class="number">100</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d,%#x\n"</span>, p[i], &amp;p[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//手动释放内存 </span></span><br><span class="line">	<span class="comment">//free()释放动态分配的内存空间</span></span><br><span class="line">	<span class="built_in">free</span>(p);</span><br><span class="line"></span><br><span class="line">	getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>realloc 重新分配内存</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"第一次输入数组的长度："</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//int* p = malloc(len * sizeof(int));	</span></span><br><span class="line">	<span class="keyword">int</span>* p = <span class="built_in">calloc</span>(len, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (; i &lt; len; i++)&#123;</span><br><span class="line">		p[i] = rand() % <span class="number">100</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d,%#x\n"</span>, p[i], &amp;p[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> addLen;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"输入数组增加的长度："</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;addLen);</span><br><span class="line">	<span class="comment">//内存不够用，扩大刚刚分配的内存空间</span></span><br><span class="line">	<span class="comment">//1.原来内存的指针 2.内存扩大之后的总大小		</span></span><br><span class="line">	<span class="keyword">int</span>* p2 = <span class="built_in">realloc</span>(p, <span class="keyword">sizeof</span>(<span class="keyword">int</span>) * (len + addLen));</span><br><span class="line">	<span class="keyword">if</span> (p2 == <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"重新分配失败，世界那么大，容不下我。。。"</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="新分配内存的两种情况："><a href="#新分配内存的两种情况：" class="headerlink" title="新分配内存的两种情况："></a><strong>新分配内存的两种情况：</strong></h2><p>   //缩小，缩小的那一部分数据会丢失<br>    //扩大，（连续的）<br>    1.如果当前内存段后面有需要的内存空间，直接扩展这段内存空间，realloc返回原指针<br>    2.如果当前内存段后面的空闲字节不够，那么就使用堆中的第一个能够满足这一要求的内存块，将目前的数据复制到新的位置，并将原来的数据库释放掉，返回新的内存地址<br>    3.如果申请失败，返回NULL，原来的指针仍然有效<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接着上面的代码重新赋值</span></span><br><span class="line">	i = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"--------------------------\n"</span>);</span><br><span class="line">	<span class="keyword">for</span> (; i &lt; len + addLen; i++)&#123;</span><br><span class="line">		p2[i] = rand() % <span class="number">200</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d,%#x\n"</span>, p2[i], &amp;p2[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//手动释放内存</span></span><br><span class="line">	<span class="keyword">if</span> (p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">free</span>(p);</span><br><span class="line">		p = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">if</span> (p2 != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">free</span>(p2);</span><br><span class="line">		p2 = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="内存分配的几个注意细节"><a href="#内存分配的几个注意细节" class="headerlink" title="内存分配的几个注意细节"></a><strong>内存分配的几个注意细节</strong></h2><p>1.不能多次释放；<br>2.释放完之后（指针仍然有值），给指针置NULL，标志释放完成；<br>3.内存泄露（p重新赋值之后，再free，并没有真正释放内存）；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"输入数组的长度："</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span>* p = <span class="built_in">malloc</span>(len * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));		</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (; i &lt; len; i++)&#123;</span><br><span class="line">		p[i] = rand() % <span class="number">100</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d,%#x\n"</span>, p[i], &amp;p[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">free</span>(p);</span><br><span class="line">		p = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是C语言中对内存的分配与释放，常用的几个函数~</p>
<p>CSDN</p>
<h2 id="更多系列相关文章传送门："><a href="#更多系列相关文章传送门：" class="headerlink" title="更多系列相关文章传送门："></a>更多系列相关文章传送门：</h2><p><a href="http://blog.csdn.net/u011974987/article/details/52138798" target="_blank" rel="noopener">C语言（一）基本数据类型</a><br><a href="http://blog.csdn.net/u011974987/article/details/52142794" target="_blank" rel="noopener">C语言（二）有符号数和无符号数的理解</a><br><a href="http://blog.csdn.net/u011974987/article/details/52200178" target="_blank" rel="noopener">C语言（三）字符串处理函数</a><br><a href="http://blog.csdn.net/u011974987/article/details/52270018" target="_blank" rel="noopener">C语言（四）指针概念的理解</a><br><a href="http://blog.csdn.net/u011974987/article/details/52290724" target="_blank" rel="noopener">C语言（五）内存的分配与释放</a><br><a href="http://blog.csdn.net/u011974987/article/details/52305364" target="_blank" rel="noopener">C语言（六）结构体和联合体</a><br><a href="http://blog.csdn.net/u011974987/article/details/52354074" target="_blank" rel="noopener">C语言（七）文件的相关操作</a></p>
<blockquote>
<p>学习理解并整理下来的笔记。<br>希望大家能够指点或提出宝贵意见，谢谢！一起学习。</p>
</blockquote>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程语言/">编程语言</a></li></ul>

      
        <div id="donation_div"></div>

<script src="/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: 'Donate', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
            
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/25/c/structure-union/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          C语言（六）结构体和联合体
        
      </div>
    </a>
  
  
    <a href="/2016/08/22/c-pointers/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">C语言（四）指针概念的理解</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是堆？说到堆，又忍不住说到了栈！什么是-栈？"><span class="nav-number">1.</span> <span class="nav-text"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x5806;&#xFF1F;&#x8BF4;&#x5230;&#x5806;&#xFF0C;&#x53C8;&#x5FCD;&#x4E0D;&#x4F4F;&#x8BF4;&#x5230;&#x4E86;&#x6808;&#xFF01;&#x4EC0;&#x4E48;&#x662F;-&#x6808;&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x5806;&#xFF1F;&#x8BF4;&#x5230;&#x5806;&#xFF0C;&#x53C8;&#x5FCD;&#x4E0D;&#x4F4F;&#x8BF4;&#x5230;&#x4E86;&#x6808;&#xFF01;&#x4EC0;&#x4E48;&#x662F; &#x6808;&#xFF1F;"></a><strong>&#x4EC0;&#x4E48;&#x662F;&#x5806;&#xFF1F;&#x8BF4;&#x5230;&#x5806;&#xFF0C;&#x53C8;&#x5FCD;&#x4E0D;&#x4F4F;&#x8BF4;&#x5230;&#x4E86;&#x6808;&#xFF01;&#x4EC0;&#x4E48;&#x662F; &#x6808;&#xFF1F;</strong></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C语言程序编译的内存分配，堆与栈的区别："><span class="nav-number">2.</span> <span class="nav-text"><a href="#C&#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF0C;&#x5806;&#x4E0E;&#x6808;&#x7684;&#x533A;&#x522B;&#xFF1A;" class="headerlink" title="C&#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF0C;&#x5806;&#x4E0E;&#x6808;&#x7684;&#x533A;&#x522B;&#xFF1A;"></a><strong>C&#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF0C;&#x5806;&#x4E0E;&#x6808;&#x7684;&#x533A;&#x522B;&#xFF1A;</strong></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新分配内存的两种情况："><span class="nav-number">3.</span> <span class="nav-text"><a href="#&#x65B0;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;" class="headerlink" title="&#x65B0;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;"></a><strong>&#x65B0;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</strong></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存分配的几个注意细节"><span class="nav-number">4.</span> <span class="nav-text"><a href="#&#x5185;&#x5B58;&#x5206;&#x914D;&#x7684;&#x51E0;&#x4E2A;&#x6CE8;&#x610F;&#x7EC6;&#x8282;" class="headerlink" title="&#x5185;&#x5B58;&#x5206;&#x914D;&#x7684;&#x51E0;&#x4E2A;&#x6CE8;&#x610F;&#x7EC6;&#x8282;"></a><strong>&#x5185;&#x5B58;&#x5206;&#x914D;&#x7684;&#x51E0;&#x4E2A;&#x6CE8;&#x610F;&#x7EC6;&#x8282;</strong></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更多系列相关文章传送门："><span class="nav-number">5.</span> <span class="nav-text"><a href="#&#x66F4;&#x591A;&#x7CFB;&#x5217;&#x76F8;&#x5173;&#x6587;&#x7AE0;&#x4F20;&#x9001;&#x95E8;&#xFF1A;" class="headerlink" title="&#x66F4;&#x591A;&#x7CFB;&#x5217;&#x76F8;&#x5173;&#x6587;&#x7AE0;&#x4F20;&#x9001;&#x95E8;&#xFF1A;"></a>&#x66F4;&#x591A;&#x7CFB;&#x5217;&#x76F8;&#x5173;&#x6587;&#x7AE0;&#x4F20;&#x9001;&#x95E8;&#xFF1A;</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 Xiho’s Blog All Rights Reserved.
          
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
